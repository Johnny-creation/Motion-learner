# SAM 3D Body - äººä½“3Dé‡å»ºä¸åŠ¨ä½œåˆ†æå·¥å…·

åŸºäº Meta SAM 3D Body çš„å®Œæ•´äººä½“3Dé‡å»ºè§£å†³æ–¹æ¡ˆï¼Œä»å•å¼ å›¾ç‰‡æˆ–è§†é¢‘ç”Ÿæˆé«˜ç²¾åº¦3Däººä½“æ¨¡å‹ï¼Œé€šè¿‡äº¤äº’å¼ç½‘é¡µæŸ¥çœ‹å™¨å®ç°360åº¦åŠ¨ä½œåˆ†æã€‚

## æ•ˆæœå±•ç¤º

### é™æ€åœºæ™¯åˆ†æ
![Girl Example](output/girl_vis.jpg)
*ä»å•å¼ ç…§ç‰‡é‡å»º3Däººä½“æ¨¡å‹ - å±•ç¤ºåŸå›¾ã€æ£€æµ‹æ¡†ã€3Dç½‘æ ¼å’Œä¾§è§†å›¾*

### è¿åŠ¨å§¿æ€æ•æ‰
![Runner Example](output/runner_vis.jpg)
*è·‘æ­¥åŠ¨ä½œæ•æ‰ä¸3Dé‡å»º - ç²¾ç¡®æ•æ‰è¿åŠ¨ä¸­çš„èº«ä½“å§¿æ€*

## æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ é‡å»ºèƒ½åŠ›
- **å•å›¾é‡å»º** - ä»ä¸€å¼ ç…§ç‰‡ç”Ÿæˆå®Œæ•´çš„3Däººä½“ç½‘æ ¼æ¨¡å‹
- **è§†é¢‘åºåˆ—å¤„ç†** - é€å¸§æå–åŠ¨ä½œï¼Œæ”¯æŒè·³å¸§åŠ é€Ÿ
- **å¤šäººåŒæ—¶æ£€æµ‹** - è‡ªåŠ¨è¯†åˆ«å›¾åƒä¸­çš„æ‰€æœ‰äººç‰©
- **å…¨èº«ç²¾ç»†å»ºæ¨¡** - åŒ…å«èº«ä½“ã€æ‰‹éƒ¨ã€è„šéƒ¨ç»†èŠ‚ï¼ˆ18,439é¡¶ç‚¹ï¼Œ36,874é¢ç‰‡ï¼Œ70ä¸ª3Då…³é”®ç‚¹ï¼‰

### ğŸ® äº¤äº’å¼3DæŸ¥çœ‹å™¨
- **360åº¦è‡ªç”±è§†è§’** - é¼ æ ‡æ‹–æ‹½ä»»æ„è§’åº¦è§‚å¯ŸåŠ¨ä½œç»†èŠ‚
- **é¢„è®¾è§†è§’åˆ‡æ¢** - ä¸€é”®åˆ‡æ¢æ­£é¢/èƒŒé¢/å·¦ä¾§/å³ä¾§è§†è§’
- **å¤šç§æ˜¾ç¤ºæ¨¡å¼** - å®ä½“ç½‘æ ¼ã€çº¿æ¡†ã€éª¨æ¶å¯è§†åŒ–
- **è§†è§’é”å®šåŠŸèƒ½** - ä¿æŒç›¸åŒè§‚å¯Ÿè§’åº¦å¯¹æ¯”ä¸åŒå¸§

### ğŸ“¹ è§†é¢‘æ’­æ”¾æ§åˆ¶
- **ç²¾ç¡®é€å¸§æµè§ˆ** - æ–¹å‘é”®æ§åˆ¶æ¯ä¸€å¸§ï¼ŒShift+æ–¹å‘é”®è·³è·ƒ5å¸§
- **å˜é€Ÿæ’­æ”¾** - 0.25x ~ 4x çµæ´»è°ƒé€Ÿ
- **è¿›åº¦æ ‡è®°ç³»ç»Ÿ** - æ ‡è®°å…³é”®åŠ¨ä½œå¸§ï¼Œå¿«é€Ÿå›é¡¾
- **å¸§å·ç²¾å‡†è·³è½¬** - ç›´æ¥å®šä½åˆ°ä»»æ„å¸§
- **å®Œæ•´å¿«æ·é”®æ”¯æŒ** - ç©ºæ ¼æ’­æ”¾/æš‚åœï¼Œé”®ç›˜é«˜æ•ˆæ“ä½œ

### ğŸŒ Webåº”ç”¨é›†æˆ
- **ä¸€é”®å¯åŠ¨ Demo** - æ‹–æ‹½ä¸Šä¼ ï¼Œå®æ—¶è¿›åº¦æ˜¾ç¤º
- **HTTPSè¿œç¨‹è®¿é—®** - æ”¯æŒæ‰‹æœº/å±€åŸŸç½‘ä¸Šä¼ ï¼Œè‡ªåŠ¨SSLè¯ä¹¦ç”Ÿæˆ
- **å¤šæ ¼å¼æ”¯æŒ** - å›¾ç‰‡(JPG/PNG)ã€è§†é¢‘(MP4/AVI/MOV/MKV/WEBM)
- **OBJæ ¼å¼å¯¼å‡º** - å¯å¯¼å…¥Blenderã€Mayaç­‰ä¸“ä¸š3Dè½¯ä»¶

## åº”ç”¨åœºæ™¯

- **èˆè¹ˆæ•™å­¦** - å¤šè§’åº¦å­¦ä¹ èˆè¹ˆåŠ¨ä½œï¼Œæ…¢é€Ÿé€å¸§åˆ†æç»†èŠ‚
- **ä½“è‚²è®­ç»ƒ** - å§¿åŠ¿çº æ­£ï¼ŒåŠ¨ä½œæ ‡å‡†åŒ–åˆ†æ
- **å¥èº«æŒ‡å¯¼** - è§‚å¯ŸåŠ¨ä½œè§„èŒƒæ€§ï¼Œé¿å…è¿åŠ¨æŸä¼¤
- **åŠ¨ç”»åˆ¶ä½œ** - äººä½“åŠ¨ä½œå‚è€ƒï¼Œå§¿æ€ç ”ç©¶
- **åŒ»ç–—åº·å¤** - è¿åŠ¨åŠŸèƒ½è¯„ä¼°ï¼Œåº·å¤è¿›åº¦è·Ÿè¸ª
- **è™šæ‹Ÿè¯•è¡£** - 3Däººä½“æ¨¡å‹ç”Ÿæˆ

## å¿«é€Ÿå¼€å§‹

### ä¸€é”®å¯åŠ¨ Web Demoï¼ˆæ¨èï¼‰

```bash
python demo.py
```

æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€ï¼Œæ“ä½œæµç¨‹ï¼š
1. æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡/è§†é¢‘
2. æŸ¥çœ‹å®æ—¶å¤„ç†è¿›åº¦
3. è‡ªåŠ¨è·³è½¬åˆ°3DæŸ¥çœ‹å™¨
4. ä½¿ç”¨é¼ æ ‡å’Œé”®ç›˜äº¤äº’å¼æŸ¥çœ‹

### å‘½ä»¤è¡Œå¿«é€Ÿå¤„ç†

**å¤„ç†å›¾ç‰‡ï¼š**
```bash
python process_image.py --image your_image.jpg
python viewer.py --mhr output/your_image.mhr.json
```

**å¤„ç†è§†é¢‘ï¼š**
```bash
python process_video.py --video your_video.mp4 --frame_skip 2
python viewer.py --mhr_folder output/your_video/
```

## å®‰è£…é…ç½®

### ç¯å¢ƒè¦æ±‚
- Python 3.11
- CUDA 12.1ï¼ˆæ¨èä½¿ç”¨GPUï¼Œ8GB+ VRAMï¼‰
- æ“ä½œç³»ç»Ÿï¼šLinux / macOS / Windows

### æ­¥éª¤ 1: åˆ›å»ºç¯å¢ƒ

```bash
conda create -n 3d python=3.11 -y
conda activate 3d
```

### æ­¥éª¤ 2: å®‰è£…ä¾èµ–

```bash
# å®‰è£… PyTorch (CUDA 12.1)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# å®‰è£…æ ¸å¿ƒä¾èµ–
pip install pytorch-lightning pyrender opencv-python yacs scikit-image einops timm \
    dill pandas rich hydra-core hydra-submitit-launcher hydra-colorlog pyrootutils \
    webdataset chump networkx==3.2.1 roma joblib seaborn wandb appdirs appnope \
    ffmpeg cython jsonlines pytest xtcocotools loguru optree fvcore black \
    pycocotools tensorboard huggingface_hub

# å®‰è£… Detectron2ï¼ˆäººä½“æ£€æµ‹ï¼‰
pip install 'git+https://github.com/facebookresearch/detectron2.git@a1ce2f9' \
    --no-build-isolation --no-deps

# å®‰è£… MoGeï¼ˆFOVä¼°è®¡ï¼‰
pip install git+https://github.com/microsoft/MoGe.git
```

### æ­¥éª¤ 3: ä¸‹è½½æ¨¡å‹

**æ³¨æ„ï¼š** éœ€è¦å…ˆç”³è¯· HuggingFace è®¿é—®æƒé™

è®¿é—® [facebook/sam-3d-body-dinov3](https://huggingface.co/facebook/sam-3d-body-dinov3) ç”³è¯·è®¿é—®

```bash
# ç™»å½• HuggingFace
huggingface-cli login

# ä¸‹è½½ SAM 3D Body æ¨¡å‹ (~2.7GB)
huggingface-cli download facebook/sam-3d-body-dinov3 \
    --local-dir checkpoints/sam-3d-body-dinov3

# ä¸‹è½½ MoGe æ¨¡å‹ (~1.3GB)
huggingface-cli download Ruicheng/moge-2-vitl-normal \
    --local-dir checkpoints/moge-2-vitl-normal
```

## ä½¿ç”¨æŒ‡å—

### æ–¹å¼ä¸€ï¼šWeb Demoï¼ˆæœ€ç®€å•ï¼‰

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆé»˜è®¤ç«¯å£ 8080ï¼‰
python demo.py

# è‡ªå®šä¹‰é…ç½®
python demo.py --port 8080 --output ./output --host 0.0.0.0
```

**åŠŸèƒ½è¯´æ˜ï¼š**
- è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
- æ‹–æ‹½ä¸Šä¼ æ–‡ä»¶
- å®æ—¶å¤„ç†è¿›åº¦
- å®Œæˆåè‡ªåŠ¨è·³è½¬3DæŸ¥çœ‹å™¨

### æ–¹å¼äºŒï¼šHTTPS è¿œç¨‹ä¸Šä¼ 

é€‚ç”¨äºéœ€è¦ä»æ‰‹æœºæˆ–å±€åŸŸç½‘è®¾å¤‡ä¸Šä¼ æ–‡ä»¶çš„åœºæ™¯ã€‚

```bash
# è‡ªåŠ¨ç”ŸæˆSSLè¯ä¹¦ï¼ˆæ¨èï¼‰
python test_upload.py --auto-cert

# è‡ªå®šä¹‰ç«¯å£
python test_upload.py --port 8080 --auto-cert

# ä½¿ç”¨è‡ªå®šä¹‰è¯ä¹¦
python test_upload.py --ssl --cert my_cert.pem --key my_key.pem
```

**è®¿é—®æ–¹å¼ï¼š**
1. æµè§ˆå™¨è®¿é—® `https://your_ip:8080`
2. é¦–æ¬¡è®¿é—®éœ€ä¿¡ä»»è‡ªç­¾åè¯ä¹¦ï¼ˆç‚¹å‡»"é«˜çº§" â†’ "ç»§ç»­è®¿é—®"ï¼‰
3. ä¸Šä¼ æ–‡ä»¶å¹¶å¼€å§‹å¤„ç†

**æ³¨æ„ï¼š** é¦–æ¬¡ä½¿ç”¨ `--auto-cert` éœ€è¦å®‰è£… `pip install cryptography`

### æ–¹å¼ä¸‰ï¼šå‘½ä»¤è¡Œæ‰¹å¤„ç†

#### å•å¼ å›¾ç‰‡å¤„ç†

```bash
python process_image.py --image your_image.jpg [é€‰é¡¹]
```

**å¸¸ç”¨å‚æ•°ï¼š**
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--output_folder` | `./output` | è¾“å‡ºç›®å½• |
| `--bbox_thresh` | `0.8` | äººä½“æ£€æµ‹é˜ˆå€¼ï¼ˆ0-1ï¼Œè¶Šä½æ£€æµ‹è¶Šå¤šäººï¼‰ |
| `--export_obj` | `False` | å¯¼å‡ºOBJæ ¼å¼ï¼ˆç”¨äºBlenderç­‰è½¯ä»¶ï¼‰ |
| `--save_vis` | `True` | ä¿å­˜2Då¯è§†åŒ–ç»“æœ |

**ç¤ºä¾‹ï¼š**
```bash
# æ£€æµ‹æ‰€æœ‰äººç‰©å¹¶å¯¼å‡ºOBJ
python process_image.py --image group.jpg --bbox_thresh 0.6 --export_obj

# æŸ¥çœ‹ç»“æœ
python viewer.py --mhr output/group.mhr.json
```

#### è§†é¢‘å¤„ç†

```bash
python process_video.py --video your_video.mp4 [é€‰é¡¹]
```

**å¸¸ç”¨å‚æ•°ï¼š**
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--frame_skip` | `0` | è·³å¸§æ•°ï¼ˆ0=ä¸è·³ï¼Œ2=æ¯3å¸§å–1å¸§ï¼‰ |
| `--start_frame` | `0` | èµ·å§‹å¸§å· |
| `--end_frame` | `-1` | ç»“æŸå¸§å·ï¼ˆ-1=å¤„ç†åˆ°ç»“å°¾ï¼‰ |
| `--bbox_thresh` | `0.8` | äººä½“æ£€æµ‹é˜ˆå€¼ |
| `--save_vis` | `False` | ä¿å­˜æ¯å¸§å¯è§†åŒ–ï¼ˆå ç”¨å¤§é‡ç©ºé—´ï¼‰ |

**å¤„ç†æ—¶é—´å»ºè®®ï¼š**
- **çŸ­è§†é¢‘ï¼ˆ<30ç§’ï¼‰** - `--frame_skip 0` å®Œæ•´å¤„ç†
- **ä¸­ç­‰è§†é¢‘ï¼ˆ1-3åˆ†é’Ÿï¼‰** - `--frame_skip 2` æ¯3å¸§å–1å¸§
- **é•¿è§†é¢‘ï¼ˆ>3åˆ†é’Ÿï¼‰** - `--frame_skip 4` æˆ–æŒ‡å®šå¸§èŒƒå›´

**ç¤ºä¾‹ï¼š**
```bash
# å¤„ç†30ç§’-1åˆ†é’Ÿç‰‡æ®µ
python process_video.py --video dance.mp4 --start_frame 900 --end_frame 1800

# å¿«é€Ÿé¢„è§ˆï¼ˆè·³å¸§å¤„ç†ï¼‰
python process_video.py --video action.mp4 --frame_skip 5

# æŸ¥çœ‹ç»“æœ
python viewer.py --mhr_folder output/dance/
```

## 3DæŸ¥çœ‹å™¨æ“ä½œ

### ğŸ¤š æ‰‹åŠ¿è¯†åˆ«æ§åˆ¶ï¼ˆä¸»è¦äº¤äº’æ–¹å¼ï¼‰

3DæŸ¥çœ‹å™¨æ”¯æŒåŸºäº **MediaPipe** çš„å®æ—¶æ‰‹åŠ¿è¯†åˆ«ï¼Œè®©ä½ æ— éœ€æ¥è§¦è®¾å¤‡å³å¯æ“æ§3Dæ¨¡å‹ã€‚åªéœ€å°†æ‰‹ä¼¸å‘æ‘„åƒå¤´ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«æ‰‹åŠ¿å¹¶æ‰§è¡Œç›¸åº”æ“ä½œã€‚

#### å•æ‰‹æ‰‹åŠ¿æ§åˆ¶

| æ‰‹åŠ¿ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| ğŸ‘ **å¤§æ‹‡æŒ‡å‘ä¸Š** | ä¸‹ä¸€å¸§/ä¸‹ä¸€ä¸ªæ¨¡å‹ | å¿«é€Ÿæµè§ˆåŠ¨ä½œåºåˆ— |
| ğŸ¤™ **å°æŒ‡å‘ä¸Š** | ä¸Šä¸€å¸§/ä¸Šä¸€ä¸ªæ¨¡å‹ | å›é€€æŸ¥çœ‹ç»†èŠ‚ |
| ğŸ‘ˆ **é£ŸæŒ‡æŒ‡å‘å·¦ä¾§** | å¿«é€€5å¸§ | è·³è¿‡é‡å¤åŠ¨ä½œ |
| ğŸ‘‰ **é£ŸæŒ‡æŒ‡å‘å³ä¾§** | å¿«è¿›5å¸§ | è·³è¿‡é‡å¤åŠ¨ä½œ |
| âœŒï¸ **Vå­—æ‰‹åŠ¿** | åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼ | åœ¨ç½‘æ ¼/çº¿æ¡†/éª¨æ¶é—´åˆ‡æ¢ |

#### åŒæ‰‹æ‰‹åŠ¿æ§åˆ¶

| æ‰‹åŠ¿ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| ğŸ‘ŠğŸ‘Š **åŒæ‰‹æ¡æ‹³** | é‡ç½®è§†è§’ | å¿«é€Ÿæ¢å¤é»˜è®¤è§‚å¯Ÿè§’åº¦ |
| ğŸ–ï¸ğŸ–ï¸ **åŒæ‰‹å¼ å¼€** | æ’­æ”¾/æš‚åœè§†é¢‘ | æ§åˆ¶è§†é¢‘æ’­æ”¾çŠ¶æ€ |

#### æ‰‹åŠ¿è¯†åˆ«ä½¿ç”¨æŠ€å·§

1. **é¦–æ¬¡ä½¿ç”¨** - æµè§ˆå™¨ä¼šè¯·æ±‚æ‘„åƒå¤´æƒé™ï¼Œè¯·å…è®¸è®¿é—®
2. **æ‰‹åŠ¿ç¨³å®šæ€§** - ä¿æŒæ‰‹åŠ¿1ç§’ä»¥ç¡®ä¿å‡†ç¡®è¯†åˆ«ï¼ˆç³»ç»Ÿéœ€è¦3å¸§ä¸€è‡´æ€§ç¡®è®¤ï¼‰
3. **æœ€ä½³è·ç¦»** - è·ç¦»æ‘„åƒå¤´ 30-80cmï¼Œç¡®ä¿æ‰‹éƒ¨å®Œæ•´å‡ºç°åœ¨ç”»é¢ä¸­
4. **å…‰çº¿æ¡ä»¶** - åœ¨æ˜äº®ç¯å¢ƒä¸‹è¯†åˆ«æ•ˆæœæ›´å¥½
5. **æ‰‹åŠ¿é—´éš”** - æ¯ä¸ªæ‰‹åŠ¿æ‰§è¡Œåæœ‰ 300-500ms å†·å´æ—¶é—´ï¼Œé¿å…è¯¯è§¦å‘
6. **è§†è§‰åé¦ˆ** - æˆåŠŸè¯†åˆ«æ—¶ç•Œé¢ä¼šæœ‰æ˜æ˜¾çš„è§†è§‰æç¤º

#### MediaPipe è‡ªåŠ¨åŠ è½½

ç³»ç»Ÿä¼šè‡ªåŠ¨ä» CDN åŠ è½½ MediaPipe åº“ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚å¦‚æœç½‘ç»œå—é™ï¼Œå¯ä»¥ï¼š
- ä½¿ç”¨å¤‡ç”¨ CDNï¼ˆjsDelivrã€unpkgï¼‰
- æœ¬åœ°éƒ¨ç½² MediaPipe æ–‡ä»¶

### ä¼ ç»Ÿæ“ä½œæ–¹å¼ï¼ˆè¾…åŠ©ï¼‰

**é¼ æ ‡æ§åˆ¶ï¼š** å·¦é”®æ‹–åŠ¨æ—‹è½¬ã€æ»šè½®ç¼©æ”¾ã€å³é”®å¹³ç§»
**é”®ç›˜å¿«æ·é”®ï¼š** ç©ºæ ¼æ’­æ”¾/æš‚åœã€æ–¹å‘é”®é€å¸§æ§åˆ¶ã€Shift+æ–¹å‘é”®è·³5å¸§ã€+/- ç¼©æ”¾ã€Q/E æ—‹è½¬ã€F/B åˆ‡æ¢æ­£é¢/èƒŒé¢è§†è§’
**ç•Œé¢æŒ‰é’®ï¼š** é¢„è®¾è§†è§’åˆ‡æ¢ã€æ˜¾ç¤ºæ¨¡å¼é€‰æ‹©ã€æ’­æ”¾æ§åˆ¶ã€è¿›åº¦æ ‡è®°ã€è§†è§’é”å®šç­‰

## å®ç”¨æŠ€å·§

### ğŸ•º å­¦ä¹ èˆè¹ˆåŠ¨ä½œ

1. å¤„ç†èˆè¹ˆè§†é¢‘
   ```bash
   python demo.py
   # ä¸Šä¼ è§†é¢‘ï¼Œç­‰å¾…å¤„ç†å®Œæˆ
   ```

2. åœ¨æŸ¥çœ‹å™¨ä¸­æ“ä½œ
   - ç‚¹å‡»"é”å®šè§†è§’"æŒ‰é’®
   - åˆ‡æ¢åˆ°"èƒŒé¢è§†è§’"
   - ä½¿ç”¨é€å¸§æ’­æ”¾ï¼ˆâ†/â†’é”®ï¼‰
   - æŒ‰Mé”®æ ‡è®°å…³é”®åŠ¨ä½œå¸§

3. åå¤å­¦ä¹ 
   - ç‚¹å‡»è¿›åº¦æ ‡è®°å¿«é€Ÿå›åˆ°å…³é”®å¸§
   - è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼ˆ0.25xæ…¢é€Ÿè§‚å¯Ÿï¼‰
   - æ—‹è½¬è§†è§’è§‚å¯Ÿç»†èŠ‚

### âš½ åˆ†æè¿åŠ¨å§¿åŠ¿

1. å¤„ç†åŠ¨ä½œå›¾ç‰‡
   ```bash
   python process_image.py --image pose.jpg
   python viewer.py --mhr output/pose.mhr.json
   ```

2. å¤šè§’åº¦åˆ†æ
   - ä½¿ç”¨é¢„è®¾è§†è§’æŒ‰é’®å¿«é€Ÿåˆ‡æ¢
   - å¼€å¯éª¨æ¶æ˜¾ç¤ºæŸ¥çœ‹å…³èŠ‚ä½ç½®
   - ä½¿ç”¨ç¼©æ”¾åŠŸèƒ½è§‚å¯Ÿç»†èŠ‚
   - å·¦é”®æ‹–åŠ¨è‡ªç”±æ—‹è½¬åˆ°ä»»æ„è§’åº¦

### ğŸ“Š å¯¹æ¯”å¤šä¸ªå§¿åŠ¿

1. æ‰¹é‡å¤„ç†åˆ°åŒä¸€ç›®å½•
   ```bash
   python process_image.py --image pose1.jpg
   python process_image.py --image pose2.jpg
   python process_image.py --image pose3.jpg
   ```

2. æ–‡ä»¶å¤¹æŸ¥çœ‹æ¨¡å¼
   ```bash
   python viewer.py --mhr_folder output/
   ```

3. é”å®šè§†è§’å¯¹æ¯”
   - ç‚¹å‡»"é”å®šè§†è§’"
   - åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­åˆ‡æ¢ä¸åŒå§¿åŠ¿
   - ä¿æŒç›¸åŒè§’åº¦å¯¹æ¯”ç»†èŠ‚å·®å¼‚

### ğŸ¬ åˆ¶ä½œåŠ¨ç”»å‚è€ƒ

1. å¯¼å‡ºOBJæ–‡ä»¶
   ```bash
   python process_image.py --image ref.jpg --export_obj
   ```

2. å¯¼å…¥3Dè½¯ä»¶
   - è¾“å‡ºæ–‡ä»¶ï¼š`output/ref_person0.obj`
   - å¯å¯¼å…¥Blenderã€Mayaã€3ds Maxç­‰
   - åŒ…å«å®Œæ•´é¡¶ç‚¹å’Œé¢ç‰‡ä¿¡æ¯

## è¾“å‡ºæ–‡ä»¶æ ¼å¼

### å•å›¾è¾“å‡ºç»“æ„
```
output/
â”œâ”€â”€ image_name.mhr.json       # 3Dç½‘æ ¼æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
â”œâ”€â”€ image_name_vis.jpg        # 2Då¯è§†åŒ–ç»“æœ
â””â”€â”€ image_name_person0.obj    # OBJæ–‡ä»¶ï¼ˆå¯é€‰ï¼Œç”¨--export_objç”Ÿæˆï¼‰
```

### è§†é¢‘è¾“å‡ºç»“æ„
```
output/video_name/
â”œâ”€â”€ video_info.json           # è§†é¢‘å…ƒä¿¡æ¯ï¼ˆfpsã€åˆ†è¾¨ç‡ã€æ€»å¸§æ•°ï¼‰
â”œâ”€â”€ faces.json                # å…±äº«é¢ç‰‡ç´¢å¼•æ•°æ®ï¼ˆæ‰€æœ‰å¸§å…±ç”¨ï¼‰
â”œâ”€â”€ frame_000000.mhr.json     # ç¬¬1å¸§æ•°æ®
â”œâ”€â”€ frame_000001.mhr.json     # ç¬¬2å¸§æ•°æ®
â”œâ”€â”€ frame_000002.mhr.json     # ç¬¬3å¸§æ•°æ®
â””â”€â”€ ...
```

### MHR JSON æ ¼å¼è¯´æ˜

MHRï¼ˆMomentum Human Rigï¼‰æ˜¯æœ¬é¡¹ç›®ä½¿ç”¨çš„3Däººä½“è¡¨ç¤ºæ ¼å¼ï¼š

```json
{
  "version": "1.0",
  "image_path": "åŸå§‹å›¾ç‰‡è·¯å¾„",
  "image_size": [å®½åº¦, é«˜åº¦],
  "num_people": æ£€æµ‹åˆ°çš„äººæ•°,
  "faces": [[v0, v1, v2], ...],  // 36,874ä¸ªä¸‰è§’é¢ç‰‡ç´¢å¼•
  "people": [
    {
      "id": äººç‰©ID,
      "bbox": [x, y, w, h],
      "focal_length": ç„¦è·,
      "camera": {
        "translation": [tx, ty, tz]
      },
      "mesh": {
        "vertices": [[x,y,z], ...],      // 18,439ä¸ª3Dé¡¶ç‚¹åæ ‡
        "keypoints_3d": [[x,y,z], ...],  // 70ä¸ª3Då…³é”®ç‚¹
        "keypoints_2d": [[x,y,conf], ...] // 70ä¸ª2DæŠ•å½±ç‚¹
      },
      "params": {
        "global_rot": [...],    // å…¨å±€æ—‹è½¬å‚æ•°
        "body_pose": [...],     // èº«ä½“å§¿æ€
        "shape": [...],         // å½¢çŠ¶å‚æ•°
        "scale": [...],         // ç¼©æ”¾
        "hand": [...],          // æ‰‹éƒ¨å§¿æ€
        "expression": [...]     // è¡¨æƒ…å‚æ•°
      }
    }
  ]
}
```

**å…³é”®ç‚¹å¸ƒå±€ï¼ˆ70ä¸ªç‚¹ï¼‰ï¼š**
- 17ä¸ªèº«ä½“å…³é”®ç‚¹ï¼ˆCOCOæ ¼å¼ï¼‰
- 40ä¸ªæ‰‹éƒ¨å…³é”®ç‚¹ï¼ˆæ¯åªæ‰‹20ä¸ªï¼‰
- 6ä¸ªè„šéƒ¨å…³é”®ç‚¹
- 7ä¸ªé¢å¤–å…³é”®ç‚¹ï¼ˆé¢ˆéƒ¨ã€è‚˜éƒ¨ã€è‚©å³°ç­‰ï¼‰

## æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæ¨¡å‹

**SAM 3D Body** - Meta AI
- 840Må‚æ•°çš„å•å›¾3Däººä½“é‡å»ºæ¨¡å‹
- åŸºäºDINOv2-H+ Vision Transformeræ¶æ„
- è¾“å…¥åˆ†è¾¨ç‡ï¼š512Ã—512
- è¾“å‡ºï¼šMHRæ ¼å¼ï¼ˆ18,439é¡¶ç‚¹ï¼Œ36,874é¢ç‰‡ï¼‰

**MHR (Momentum Human Rig)**
- å‚æ•°åŒ–äººä½“ç½‘æ ¼è¡¨ç¤º
- æ¯”SMPLæ›´ç²¾ç»†çš„æ‰‹éƒ¨å’Œè„šéƒ¨å»ºæ¨¡
- æ”¯æŒèº«ä½“å§¿æ€ã€å½¢çŠ¶ã€è¡¨æƒ…å‚æ•°åŒ–æ§åˆ¶

### è¾…åŠ©æ¨¡å‹

- **ViTDet** - åŸºäºVision Transformerçš„äººä½“æ£€æµ‹å™¨ï¼ˆæ¥è‡ªDetectron2ï¼‰
- **SAM2** - Segment Anything Model 2ç”¨äºäººä½“åˆ†å‰²
- **MoGe2** - Microsoftå•ç›®å‡ ä½•ä¼°è®¡å™¨ï¼Œç”¨äºFOVï¼ˆè§†åœºè§’ï¼‰ä¼°è®¡

### å‰ç«¯æŠ€æœ¯

- **Three.js** - WebGL 3Dæ¸²æŸ“å¼•æ“
- **OrbitControls** - äº¤äº’å¼ç›¸æœºæ§åˆ¶
- HTML5 + CSS3 + JavaScript

### æ·±åº¦å­¦ä¹ æ¡†æ¶

- PyTorchï¼ˆCUDA 12.1ï¼‰
- PyTorch Lightning
- Detectron2
- Hugging Face Hub

## é¡¹ç›®ç»“æ„

```
sam-3d-body/
â”œâ”€â”€ demo.py                      # ğŸŒŸ Web Demoåº”ç”¨ï¼ˆæ¨èå…¥å£ï¼‰
â”œâ”€â”€ test_upload.py               # ğŸ“± HTTPSè¿œç¨‹ä¸Šä¼ æœåŠ¡
â”œâ”€â”€ process_image.py             # ğŸ–¼ï¸  å•å›¾å¤„ç†è„šæœ¬
â”œâ”€â”€ process_video.py             # ğŸ¬ è§†é¢‘å¤„ç†è„šæœ¬
â”œâ”€â”€ viewer.py                    # ğŸ‘ï¸  3Dç½‘é¡µæŸ¥çœ‹å™¨
â”‚
â”œâ”€â”€ sam_3d_body/                 # æ ¸å¿ƒPythonåŒ…
â”‚   â”œâ”€â”€ __init__.py              # APIå¯¼å‡ºæ¥å£
â”‚   â”œâ”€â”€ build_models.py          # æ¨¡å‹åŠ è½½å‡½æ•°
â”‚   â”œâ”€â”€ sam_3d_body_estimator.py # æ¨ç†ä¼°è®¡å™¨ï¼ˆä¸»è¦APIï¼‰
â”‚   â”œâ”€â”€ models/                  # æ¨¡å‹æ¶æ„
â”‚   â”‚   â”œâ”€â”€ meta_arch/           # SAM3DBodyä¸»æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ backbones/           # DINOv2éª¨å¹²ç½‘ç»œ
â”‚   â”‚   â”œâ”€â”€ decoders/            # Transformerè§£ç å™¨
â”‚   â”‚   â”œâ”€â”€ heads/               # MHRå¤´ã€ç›¸æœºå¤´
â”‚   â”‚   â””â”€â”€ modules/             # åŸºç¡€æ¨¡å—
â”‚   â”œâ”€â”€ data/                    # æ•°æ®å¤„ç†ä¸å˜æ¢
â”‚   â”œâ”€â”€ visualization/           # å¯è§†åŒ–å·¥å…·
â”‚   â”œâ”€â”€ metadata/                # MHR70å…³é”®ç‚¹å®šä¹‰
â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ tools/                       # è¾…åŠ©å·¥å…·
â”‚   â”œâ”€â”€ mhr_io.py               # MHRæ–‡ä»¶è¯»å†™å·¥å…·
â”‚   â”œâ”€â”€ build_detector.py       # äººä½“æ£€æµ‹å™¨æ„å»º
â”‚   â”œâ”€â”€ build_sam.py            # SAM2åˆ†å‰²å™¨æ„å»º
â”‚   â”œâ”€â”€ build_fov_estimator.py  # FOVä¼°è®¡å™¨æ„å»º
â”‚   â””â”€â”€ vis_utils.py            # 2Då¯è§†åŒ–å·¥å…·
â”‚
â”œâ”€â”€ checkpoints/                 # æ¨¡å‹æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ sam-3d-body-dinov3/     # SAM 3D Bodyæ¨¡å‹ (~2.7GB)
â”‚   â”‚   â”œâ”€â”€ model.ckpt          # 840Må‚æ•°æ¨¡å‹æƒé‡
â”‚   â”‚   â”œâ”€â”€ model_config.yaml   # æ¨¡å‹é…ç½®
â”‚   â”‚   â””â”€â”€ assets/mhr_model.pt # MHRäººä½“æ¨¡å‹èµ„æº
â”‚   â”œâ”€â”€ moge-2-vitl-normal/     # MoGe FOVä¼°è®¡æ¨¡å‹ (~1.3GB)
â”‚   â””â”€â”€ vitdet/                 # ViTDetäººä½“æ£€æµ‹æ¨¡å‹
â”‚
â”œâ”€â”€ output/                      # å¤„ç†ç»“æœè¾“å‡ºç›®å½•
â”œâ”€â”€ test_uploads/                # è¿œç¨‹ä¸Šä¼ æ–‡ä»¶ä¿å­˜ç›®å½•
â”œâ”€â”€ notebook/                    # Jupyterç¤ºä¾‹
â”‚   â””â”€â”€ demo_human.ipynb        # å¿«é€Ÿå…¥é—¨ç¤ºä¾‹
â””â”€â”€ assets/                      # é¡¹ç›®èµ„æºæ–‡ä»¶
```

## æ€§èƒ½ä¸ç¡¬ä»¶è¦æ±‚

### æ¨èé…ç½®
- **GPU**: NVIDIA GPUï¼Œ8GB+ VRAMï¼ˆæ¨èRTX 3060æˆ–æ›´é«˜ï¼‰
- **CPU**: æ”¯æŒCPUæ¨¡å¼ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢
- **å†…å­˜**: 16GB+ RAM
- **å­˜å‚¨**: è‡³å°‘10GBå¯ç”¨ç©ºé—´ï¼ˆæ¨¡å‹4GB + è¾“å‡ºæ–‡ä»¶ï¼‰

### å¤„ç†é€Ÿåº¦å‚è€ƒ
- **GPUæ¨¡å¼**: ~2-5ç§’/å¸§ï¼ˆå–å†³äºGPUæ€§èƒ½ï¼‰
- **CPUæ¨¡å¼**: ~30-60ç§’/å¸§
- **è§†é¢‘å¤„ç†**: 30ç§’è§†é¢‘ï¼ˆ900å¸§ï¼‰è·³å¸§å¤„ç†çº¦5-10åˆ†é’Ÿï¼ˆGPUï¼‰

### ä¼˜åŒ–å»ºè®®
- ä½¿ç”¨ `--frame_skip` å‚æ•°è·³å¸§å¤„ç†é•¿è§†é¢‘
- æŒ‡å®š `--start_frame` å’Œ `--end_frame` åªå¤„ç†å…³é”®ç‰‡æ®µ
- æ‰¹é‡å¤„ç†æ—¶å…³é—­å¯è§†åŒ– `--save_vis False` èŠ‚çœç©ºé—´
- ä½¿ç”¨åŠç²¾åº¦æ¨ç†ï¼ˆé»˜è®¤å¯ç”¨ï¼‰åŠ é€Ÿå¤„ç†

## å¸¸è§é—®é¢˜

### æ¨¡å‹ä¸‹è½½é—®é¢˜

**Q: æ— æ³•è®¿é—®HuggingFaceï¼Ÿ**

A: å¯ä»¥ä½¿ç”¨é•œåƒç«™ç‚¹æˆ–é€šè¿‡ä»£ç†è®¿é—®ã€‚è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
export HF_ENDPOINT=https://hf-mirror.com
```

**Q: ä¸‹è½½é€Ÿåº¦æ…¢ï¼Ÿ**

A: ä½¿ç”¨ `--resume` å‚æ•°æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼š
```bash
huggingface-cli download facebook/sam-3d-body-dinov3 \
    --local-dir checkpoints/sam-3d-body-dinov3 --resume-download
```

### è¿è¡Œé”™è¯¯

**Q: CUDA out of memory é”™è¯¯ï¼Ÿ**

A: GPUæ˜¾å­˜ä¸è¶³ï¼Œå°è¯•ï¼š
- é™ä½è¾“å…¥å›¾åƒåˆ†è¾¨ç‡
- ä½¿ç”¨CPUæ¨¡å¼ï¼ˆå»æ‰CUDAå®‰è£…ï¼‰
- å¤„ç†è§†é¢‘æ—¶å¢å¤§ `--frame_skip` å€¼

**Q: æ£€æµ‹ä¸åˆ°äººç‰©ï¼Ÿ**

A: è°ƒæ•´æ£€æµ‹é˜ˆå€¼ï¼š
```bash
python process_image.py --image your.jpg --bbox_thresh 0.5
```

**Q: å¤„ç†é€Ÿåº¦æ…¢ï¼Ÿ**

A: ç¡®ä¿ä½¿ç”¨GPUæ¨¡å¼ï¼Œæ£€æŸ¥ï¼š
```python
import torch
print(torch.cuda.is_available())  # åº”è¯¥è¿”å›True
```

### Webåº”ç”¨é—®é¢˜

**Q: æµè§ˆå™¨æ²¡æœ‰è‡ªåŠ¨æ‰“å¼€ï¼Ÿ**

A: æ‰‹åŠ¨è®¿é—® `http://localhost:8080`

**Q: è¿œç¨‹è®¿é—®è¢«æ‹’ç»ï¼Ÿ**

A: ç¡®ä¿ä½¿ç”¨ `--host 0.0.0.0`ï¼š
```bash
python demo.py --host 0.0.0.0
```

**Q: HTTPSè¯ä¹¦è­¦å‘Šï¼Ÿ**

A: è‡ªç­¾åè¯ä¹¦æ˜¯å®‰å…¨çš„ï¼Œç‚¹å‡»"é«˜çº§" â†’ "ç»§ç»­è®¿é—®"å³å¯ã€‚

## API ä½¿ç”¨ç¤ºä¾‹

### Python API è°ƒç”¨

```python
from sam_3d_body import load_sam_3d_body, SAM3DBodyEstimator
from tools.build_detector import build_human_detector
from tools.build_sam import build_human_segmentor
from tools.build_fov_estimator import build_fov_estimator
import cv2

# åŠ è½½æ¨¡å‹
model, cfg = load_sam_3d_body("checkpoints/sam-3d-body-dinov3/model.ckpt")

# åˆå§‹åŒ–è¾…åŠ©æ¨¡å—
detector = build_human_detector()
segmentor = build_human_segmentor()
fov_estimator = build_fov_estimator()

# åˆ›å»ºä¼°è®¡å™¨
estimator = SAM3DBodyEstimator(
    sam_3d_body_model=model,
    model_cfg=cfg,
    human_detector=detector,
    human_segmentor=segmentor,
    fov_estimator=fov_estimator
)

# å¤„ç†å›¾ç‰‡
img = cv2.imread("image.jpg")
outputs = estimator.process_one_image(img, bbox_thr=0.8)

# è·å–ç»“æœ
for person in outputs:
    vertices = person["pred_vertices"]        # (18439, 3) é¡¶ç‚¹åæ ‡
    keypoints_3d = person["pred_keypoints_3d"] # (70, 3) 3Då…³é”®ç‚¹
    keypoints_2d = person["pred_keypoints_2d"] # (70, 3) 2DæŠ•å½±ç‚¹
    cam_t = person["pred_cam_t"]               # (3,) ç›¸æœºå¹³ç§»
    focal = person["pred_focal"]               # ç„¦è·

    print(f"æ£€æµ‹åˆ°äººç‰©ï¼Œé¡¶ç‚¹æ•°: {len(vertices)}")
    print(f"ç›¸æœºå‚æ•°: focal={focal:.2f}, translation={cam_t}")
```

### æ‰¹é‡å¤„ç†ç¤ºä¾‹

```python
import glob
from pathlib import Path

# æ‰¹é‡å¤„ç†ç›®å½•ä¸­çš„æ‰€æœ‰å›¾ç‰‡
image_dir = Path("./input_images")
output_dir = Path("./output")
output_dir.mkdir(exist_ok=True)

for img_path in glob.glob(str(image_dir / "*.jpg")):
    img = cv2.imread(img_path)
    outputs = estimator.process_one_image(img)

    # ä¿å­˜MHRæ–‡ä»¶
    output_path = output_dir / f"{Path(img_path).stem}.mhr.json"
    # ... ä¿å­˜é€»è¾‘
```

## å‚è€ƒèµ„æ–™

### å®˜æ–¹é“¾æ¥
- [SAM 3D Body è®ºæ–‡](https://research.facebook.com/publications/sam-3d-body)
- [SAM 3D Body GitHub](https://github.com/facebookresearch/sam-3d-body)
- [MHR äººä½“æ¨¡å‹](https://github.com/facebookresearch/MHR)
- [MoGe å‡ ä½•ä¼°è®¡](https://github.com/microsoft/MoGe)
- [Detectron2](https://github.com/facebookresearch/detectron2)

### ç›¸å…³æŠ€æœ¯
- [DINOv2: Self-supervised Vision Transformers](https://github.com/facebookresearch/dinov2)
- [Segment Anything Model 2](https://github.com/facebookresearch/segment-anything-2)
- [Three.js Documentation](https://threejs.org/docs/)

### å­¦æœ¯å¼•ç”¨

å¦‚æœæœ¬é¡¹ç›®å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@inproceedings{sam3dbody2024,
  title={SAM 3D Body: Segment Anything Model Meets 3D Human Body Reconstruction},
  author={Meta AI Research},
  year={2024}
}
```

## è®¸å¯åè®®

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- SAM 3D Body - Meta AIï¼ˆéµå¾ªå…¶åŸå§‹è®¸å¯ï¼‰
- MHR - Meta AI
- MoGe - Microsoft
- Detectron2 - Meta AI

è¯·å‚è€ƒå„å­é¡¹ç›®çš„è®¸å¯åè®®ã€‚

## è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’Œå›¢é˜Ÿçš„è´¡çŒ®ï¼š
- Meta AI Research - SAM 3D Bodyã€MHRã€Detectron2
- Microsoft - MoGeå•ç›®å‡ ä½•ä¼°è®¡
- PyTorchå›¢é˜Ÿ - æ·±åº¦å­¦ä¹ æ¡†æ¶
- Three.jsç¤¾åŒº - 3Då¯è§†åŒ–æ”¯æŒ

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ Star æ”¯æŒï¼**
